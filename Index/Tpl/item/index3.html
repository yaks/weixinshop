<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0048)http://store.weiapps.cn/index.php -->
<html>
    <include file="public:headtop" />
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/item/item.css" />
    
    <head>
    </head>
    
    <body id="touch">
        <include file="public:head" />
        <div id="content">
<div class="mod_slider" id="loopImgDiv">
    <div class="inner">
        <ul class="pic_list" id="loopImgUl"></ul>
    </div>
    <div class="bar_wrap">
    	<ul class="bar" id="loopImgBar"></ul>
    </div>
</div>

<div class="buy_area">
	<div id="testtt" style="display: none"></div>
    <div class="fn_wrap">
        <h1 class="fn" id="itemName">生活号外2014夏季圆领字母贴布绣烫钻宽松中长款拼接雪纺摆短袖女T恤 黑色 M</h1>
    </div>

    <div class="price_wrap">
        <span class="tit" id="priceTitle">京东价：</span>
        <span class="price" id="priceSale" price="￥78.00">￥78.00</span>
        <del class="old_price"><em id="priceMarket">￥269.00</em></del>
        <span class="col_right">
            <span class="sale_num">销量：<b id="saleNo">0</b>件</span>
        </span>
    </div>

    <div class="detail_promote detail_sendto">
        <div class="tit">送至：</div>
        <div class="promote_tag" id="addrArea">
            <div class="addr"><span id="addrName">广东</span><span class="postage" id="postPrice"></span></div>
            <div class="time"><span id="postNotice1">有货，</span><span id="postNotice2">下单后立即发货</span></div>
        </div>
        <i class="icon_promote"></i>
    </div>
    
    <div class="detail_promote detail_promote_tag" style="display: none" id="promoteDiv">
        <div class="tit">促销：</div>
        <!-- 只有一个tag时增加 promote_tag_one -->
        <div class="promote_tag" id="promote"></div>
        <i class="icon_promote"></i>
    </div>
    
	<div class="buy_tip" id="statusNotice" style="display: none">
        <i class="icon_warn"></i>
        <span id="statusNote"></span>
    </div>

    <div class="sku_container sku_container_on" id="skuCont">
	    <div class="sku_wrap">            
	    	<div id="propertyDiv"><div class="sku" id="sku1"><h3>颜色</h3><div class="sku_list"><span class="option option_selected">黑色</span><span class="option">橙色</span><span class="option">白色</span><span class="option">花灰</span></div></div><div class="sku" id="sku2"><h3>尺寸</h3><div class="sku_list"><span class="option option_selected">M</span><span class="option">L</span><span class="option">XXL</span><span class="option">XL</span></div></div></div>
	    	<div class="sku sku_num">
	            <h3>数量</h3>
	            <div class="num_wrap">
	                <span class="minus minus_disabled" id="minus"></span>
	                <input class="num" id="buyNum" type="tel" value="1">
	                <span class="plus" id="plus"></span>
	            </div>
	        </div>
	    </div>
	</div>
    
    <div class="sku_tip" id="skuNotice" style="display:none">
	    <span id="skuTitle2"></span>
	</div>

    <div class="service_wrap" id="serviveArea">
        <div class="hd" id="shopInfoP"><div class="txt" id="shopInfo">本商品由京东商户 生活号外旗舰店 提供<br>联系电话 :400-610-1360转108737</div></div>
        <ul class="service_list" id="serviceInfo">
<li>
    <i class="icon_service pop_PaymentCod"></i>
    <div class="service_txt">pop货到付款</div>
    <div class="service_desc">支持送货上门后再收款，支持现金、POS机刷卡等方式</div>
</li>
</ul>
    </div>

</div>
<div id="detailBaseLine" class="mod_tab_gap"></div>
<div class="mod_tab" id="detailTab">
	    <span class="cur" no="1">商品介绍</span>
	    <span no="2" class="">评价(<em id="evalNum">0</em>)</span>
	</div>
<div class="detail_info_wrap" id="detail" style="height: 446px;">
    <div class="detail_list" id="detailCont" style="-webkit-transform: translate3d(-3840px, 0px, 0px); -webkit-transition: all 0.3s ease; transition: all 0.3s ease;">
        <!-- 商品介绍 -->
        <div class="detail_item p_desc" id="detail1" style="position:relative;">
            <div id="appdlCon"></div>
        	<div id="commDesc" class="detail_pc"><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t157/128/1237365861/48437/aaeaf7d/53a90d35N3f02cbcd.jpg" loaded="14"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t199/257/1301719252/29970/f7652bb9/53a90d38N509879b5.jpg" loaded="13"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t145/210/1324250155/39028/a12a7a3f/53a90d3bN3c00e183.jpg" loaded="12"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t148/167/1220815573/18970/674364b0/53a90d50Nea5c07c5.jpg" loaded="11"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t160/359/1269601540/22135/8943d7ed/53a90d53N67fd1a93.jpg" loaded="10"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t145/282/1251273783/28811/3173e9ef/53a90d55N98561c00.jpg" loaded="9"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t157/201/1308081159/24422/8c2a9004/53a90d57N2b5ac718.jpg" loaded="8"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t181/98/1217363210/24407/70050a9f/53a90d5cNcba336c7.jpg" loaded="7"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t178/277/1252515482/24560/5f46a35c/53a90d60Nf84f2cfe.jpg" loaded="6"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t178/283/1239438180/41723/bebc5033/53a90d64Nd1bb6028.jpg" loaded="5"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t163/273/1275950441/48574/ff8477bd/53a90d68N2333bc10.jpg" loaded="4"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t163/305/1288845900/21083/70ae0b9/53a90d76N031cf6bc.jpg" loaded="3"><div class="\'for_separator\'"></div><img class="init_pic" src="http://img10.360buyimg.com/popWareDetail/jfs/t175/108/1221994767/36598/ed0b7195/53a90d7aNc1b44059.jpg" loaded="2"><div class="\'for_separator\'"></div></div>
        	<div id="pcItemLink">
	        	<a class="btn btn_full" href="javascript:;">查看电脑版商品详情</a>
	        	<div class="detail_full_tip">（ 查看电脑版商品详情，可能会消耗较多流量 ）</div>
        	</div>
        </div>
        <!-- 商品参数 -->
        <div class="detail_item p_prop" id="detail2"><table cellpadding="0" cellspacing="1" width="100%" border="0" class="Ptable param_table"></table></div>
        <!-- 评论 -->
        <div class="detail_item p_cmt" id="detail3">
            <ul class="cmt_list" id="evalDet">暂无评价，欢迎您购买之后留下您的宝贵评价：）<br><br><br><br><br><br><br><br><br><br><br><br></ul>
            
            <div id="eveaLoading"></div>
                <br><br><br><br><br>
        </div>
    </div>
</div>
<div class="btn_wrap btn_wrap_fixed btn_wrap_nocart" style="-webkit-transform: translateY(0px);">
   
    <div class="btn_col">
        <a class="btn btn_cart" href="javascript:;" id="addCart2" style="display: block;">加入购物车</a>
        <a class="btn btn_buy" href="javascript:;" id="buyBtn2">立即购买</a>
    </div>
 
</div>

<div class="mod_slider_mask" id="blackCover" style="display: none;"></div>

<div id="index">
           
 
 </div>
        <include file="public:footer" />
    </body>

	<script>
	function scroll(o){
        this.opt = {
            tp: 'text',
            moveDom: null,
            moveChild: [],
            tab: [],
            viewDom: null,
            sp: null,
            min: 0,
            minp: 0,
            step: 0,
            len: 1,
            index: 1,
            offset: 0,
            loadImg: false,
            image: [],
            loopScroll: false,
            lockScrY: false,
            holdAuto: false,
            stopOnce: false,
            autoTime: 0,
            tabClass: 'cur',
            transition: 0.3,
            fun: function() {}
        };
        $.extend(this, this.opt, o);
        this.len = this.moveChild.length;
        this.min = this.min || {
            'text': 100,
            'img': 30
        } [this.tp];
        this.minp = this.minp || this.min;
        if (!this.viewDom) this.viewDom = $(window);
        if (this.len > 1) this.startEvent();
        if (this.loadImg) this.image = this.moveDom.find('img');
        this.resize(this.step || this.moveChild.eq(0).width());
        if (this.autoTime) {
            var obj = this;
            setInterval(function() {
                if (!obj.holdAuto) {
                    if (!obj.stopOnce) obj.stepMove(obj.index + 1);
                    obj.stopOnce = false;
                }
            },
            this.autoTime);
        }
    };
    $.extend(scroll.prototype, {
        resize: function(step) {
            this.step = step || this.step;
            var harf = (this.viewDom.width() - this.step) / 2;
            this.offset = this.loopScroll ? this.step - harf: harf;
            if (this.len == 1) this.offset = -harf;
            this.stepMove(this.index, true);
        },
        addChild: function(dom, tabDom) {
            if (!this.loopScroll) return;
            this.moveChild.eq(0).after(dom);
            this.len += 1;
            this.tab.eq(this.len - 2).after(tabDom);
            this.tab = this.tab.parent().children();
            if (this.len == 2) {
                this.moveChild = this.moveDom.children();
                this.startEvent();
            } else {
                this.stepMove(2);
            }
        },
        startEvent: function() {
            var obj = this,
            dom = this.moveDom.get(0);
            dom.addEventListener("touchstart", this, false);
            dom.addEventListener("touchmove", this, false);
            dom.addEventListener("touchend", this, false);
            dom.addEventListener("touchcancel", this, false);
            dom.addEventListener("webkitTransitionEnd", this, false);
            this.tab.each(function(i, em) {
                $(em).attr('no', i + 1);
                $(em).click(function() {
                    obj.stepMove($(this).attr('no'));
                });
            });
            if (this.loopScroll) {
                this.moveDom.append(this.moveChild.eq(0).clone());
                var last = this.moveChild.eq(this.len - 1).clone();
                this.moveDom.prepend(last);
            }
        },
        handleEvent: function(e) {
            switch (e.type) {
            case "touchstart":
                this.sp = this.getPosition(e);
                this.holdAuto = true;
                this.stopOnce = true;
                break;
            case "touchmove":
                this.touchmove(e);
                break;
            case "touchend":
            case "touchcancel":
                this.move(e);
                this.holdAuto = false;
                break;
            case "webkitTransitionEnd":
                e.preventDefault();
                break;
            }
        },
        getPosition: function(e) {
            var touch = e.changedTouches ? e.changedTouches[0] : e;
            return {
                x: touch.pageX,
                y: touch.pageY
            };
        },
        touchmove: function(e) {
            var mp = this.getPosition(e),
            x = mp.x - this.sp.x,
            y = mp.y - this.sp.y;
            if (Math.abs(x) - Math.abs(y) > this.min) {
                e.preventDefault();
                var offset = x - this.step * (this.index - 1) - this.offset;
                this.moveDom.css({
                    "-webkit-backface-visibility": "hidden",
                    "-webkit-transform": "translate3D(" + offset + "px,0,0)",
                    "-webkit-transition": "0"
                });
            } else {
                if (!this.lockScrY) e.preventDefault();
            }
        },
        move: function(e) {
            var mp = this.getPosition(e),
            x = mp.x - this.sp.x,
            y = mp.y - this.sp.y;
            if (Math.abs(x) < Math.abs(y) || Math.abs(x) < this.minp) {
                this.stepMove(this.index);
                return;
            }
            if (x > 0) {
                e.preventDefault();
                this.stepMove(this.index - 1);
            } else {
                e.preventDefault();
                this.stepMove(this.index + 1);
            }
        },
        loadImage: function(no) {
            var img = this.image;
            var setImg = function(i) {
                if (img[i] && $(img[i]).attr('back_src')) {
                    img[i].src = $(img[i]).attr('back_src');
                    $(img[i]).removeAttr('back_src');
                }
            };
            setImg(no);
            setImg(no - 1);
            setImg(no + 1);
        },
        stepMove: function(no, isSetOffsetIndex) {
            this.index = no > this.len ? this.len: no < 1 ? 1 : no;
            this.tab.removeClass(this.tabClass);
            this.tab.eq(this.index - 1).addClass(this.tabClass);
            var tran = -this.step * ((this.loopScroll ? no: this.index) - 1) - this.offset;
            this.moveDom.css({
                "-webkit-transform": "translate3D(" + tran + "px,0,0)",
                "-webkit-transition": isSetOffsetIndex ? "0ms": "all " + this.transition + "s ease"
            });
            if (this.loadImg) this.loadImage(this.index);
            this.fun(this.index);
            if (this.loopScroll && !isSetOffsetIndex) {
                var obj = this,
                cindex = no;
                if (no <= 0) cindex = this.len;
                if (no > this.len) cindex = 1;
                if (cindex != no) setTimeout(function() {
                    obj.stepMove(cindex, true);
                },
                this.transition * 1000);
            }
        }
    });
	
	
arr =[{"id":"524","item_id":"4","url":"1406\/15\/539d78c79737f.jpg","add_time":"0","ordid":"255","status":"1"},{"id":"525","item_id":"4","url":"1406\/15\/539d78c79caf0.jpg","add_time":"0","ordid":"255","status":"1"},{"id":"529","item_id":"4","url":"1406\/28\/53adae5248a13.jpg","add_time":"0","ordid":"255","status":"1"}];
var loopImg = [];
function Setimg(images) {
        var imgStr = [],
        tab = [],
        subfix = 'http://115.29.14.203/weixinshop5/data/upload/testid111101/item/';
        this.loopImg = [];
        for (var i = 0; i < images.length; i++) {
            var src = subfix + images[i].url;
            this.loopImg.push(src.replace(/\s+/g, ''));
            imgStr.push('<li><img ' +  'src="' + src + '"></li>');
            tab.push('<li></li>');
        }
        $('#loopImgBar').html(tab.join(''));
        $('#loopImgUl').html(imgStr.join(''));
        $('#loopImgUl').css({
            left: '0px'
        });
	}
Setimg(arr);
console.log(loopImg);
	
var scroll_loop=new scroll({
            tp: 'img',
            loadImg: true,
            moveDom: $('#loopImgUl'),
            moveChild: $('#loopImgUl li'),
            tab: $('#loopImgBar li'),
            loopScroll: true,
            lockScrY: true,
            index: 1,
            fun: function(index) {}}
       ) 
	   
  		function resizeProtal(showBlack) {
        if (showBlack) {
            $('#loopImgDiv').hasClass('mod_slider_viewer') ? $('#loopImgDiv').removeClass('mod_slider_viewer') : $('#loopImgDiv').addClass('mod_slider_viewer');
        }
        scroll_loop.resize($('#loopImgUl li').eq(0).width());
    };
	

	function  hideBlackCover(){
            $('#blackCover').hide();
            var blackCoverShow = false;
            if ($('#loopImgDiv').hasClass('mod_slider_viewer')) {
                resizeProtal(true);
            } else {
                $('#imageViewer').hide();
            }
            $('#topBar').show();
        };
		
	   function showSingeImg(src)  {
            this.lockScrollH = $(window).scrollTop();
            this.blackCoverShow = true;
            $('#blackCover').show();
            $('#imageViewer').show();
            $('#fullImg').attr('src', src);
            $('#topBar').hide();
        };	
		
		
		$('#loopImgUl').on('click',
            function(e) {
			 if (window.WeixinJSBridge) {
                    WeixinJSBridge.invoke('imagePreview', {
                        'current': loopImg[scroll_loop.index - 1],
                        'urls': loopImg
                    });
                    return;
                }
            
                $('#topBar').hide();
                if (loopImg.length == 1) {
				    alert("baaaaaaaaaaaa");
                    showSingeImg(loopImg[0]);
                    return;
                }
				
				console.log(loopImg);
                if (!loopImg.length) return;
                if ($('#loopImgDiv').hasClass('mod_slider_viewer')) {
                    hideBlackCover();
                } else {
                    var lockScrollH = $(window).scrollTop();
                    var blackCoverShow = true;
                    $('#blackCover').show();
                    resizeProtal(true);
                }
            });	
	
	
	
	
	</script>
</html>